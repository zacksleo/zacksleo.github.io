<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="HSx2g2b2GklalbFMNOUlf16CH8h8aJMsL6Wa1CvfqSw" />




















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Full Stack Web Developer">
<meta name="keywords" content="PHP, Yii, Laravel, Python, Full Stack Web Developer">
<meta property="og:type" content="website">
<meta property="og:title" content="zacks&#39;s blog">
<meta property="og:url" content="https://zacksleo.github.io/index.html">
<meta property="og:site_name" content="zacks&#39;s blog">
<meta property="og:description" content="Full Stack Web Developer">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zacks&#39;s blog">
<meta name="twitter:description" content="Full Stack Web Developer">






  <link rel="canonical" href="https://zacksleo.github.io/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>zacks's blog</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-80154310-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-80154310-2');
</script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zacks's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">清净无为</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zacksleo.github.io/2019/04/24/使用Gin开发Restful接口/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zacksleo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zacks's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/24/使用Gin开发Restful接口/" itemprop="url">
                  使用Gin开发Restful接口并进行自动化测试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-24 23:11:00" itemprop="dateCreated datePublished" datetime="2019-04-24T23:11:00+08:00">2019-04-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 12:28:32" itemprop="dateModified" datetime="2019-10-22T12:28:32+08:00">2019-10-22</time>
              
            
          </span>

          

          
            
          

          
          
             <span id="/2019/04/24/使用Gin开发Restful接口/" class="leancloud_visitors" data-flag-title="使用Gin开发Restful接口并进行自动化测试">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>在之前的文章<a href="https://zacksleo.github.io/2019/04/22/Golang%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E5%92%8C%E9%83%A8%E7%BD%B2/">Golang持续集成与自动化测试和部署</a>中<br>简要介绍了如何快速搭建Api 微服务, 并进行DevOps集成。本文将进一步深入介绍，如果使用Gin实现Restful规范并进行自动化测试。</p>
<h2 id="Restful"><a href="#Restful" class="headerlink" title="Restful"></a>Restful</h2><p>在<a href="https://zacksleo.github.io/2017/03/07/RESTful%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83/">RESTful接口规范</a>一文中，介绍了 Restful 及其规范。</p>
<p>Gin 是一个性能优异的微服务框架，对于Restful有着良好的支持。因为基于此实现Restful并不困难。</p>
<p>Restful 中的核心在于对于资源的定义和使用，和对 HTTP 动词（GET, PUT, DELETE, POST, DELETE, OPTIONS）的充分使用，通过 HTTP 动词，免去了繁冗的接口方法定义。<br>例如，传统方式如果实现删除文章功能，则需要实现一个类似 <code>post/delete?id=6</code> 的方法， 如果使用 Restful, 则使用 <code>DELETE post/1</code> 形式，其中 DELETE是动词，代表删除操作，<br><code>post/1</code> 代表单个文章资源。 </p>
<p>Restful 中的另一大规法是对于状态码的充分使用，不再使用响应内容表明状态。如200代表成功，404代表资源不存在，204代表删除成功，201代表创建成功。<br>有了状态码，响应内容中不再需要使用单独的字段来标记结果的状态（如 {result: “success”} ）。</p>
<p>这样的一大好处是实现方式更规范、统一和直观。只要知道资源定义（posts）, 就可以猜测出该如何进行增删改查的操作，不再需要知道方法名。<br>如此一来，可以很轻松的封装出一套同意的方法和操作。</p>
<h3 id="路由定义"><a href="#路由定义" class="headerlink" title="路由定义"></a>路由定义</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> router</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"gitlab.com/zacksleo/project/controllers"</span></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span>	</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">		api.GET(<span class="string">"/customers"</span>, controllers.GetCustomers)</span><br><span class="line">		api.GET(<span class="string">"/customers/:id"</span>, controllers.GetCustomer)</span><br><span class="line">		api.POST(<span class="string">"/customers"</span>, controllers.CreateCustomer)</span><br><span class="line">		api.PUT(<span class="string">"/customers/:id"</span>, controllers.UpdateCustomer)</span><br><span class="line">		api.DELETE(<span class="string">"/customers/:id"</span>, controllers.DeleteCustomer)</span><br></pre></td></tr></table></figure>
<p>下面一个较为完整的案例 <code>controllers/customer.go</code></p>
<script src="https://gist.github.com/zacksleo/14abb79d52e32c6ef89d9db207fabb4f.js"></script>

<h2 id="自动化测试"><a href="#自动化测试" class="headerlink" title="自动化测试"></a>自动化测试</h2><p>当实现了接口发后，为了验证接口运行正常，确保接口可靠和可用性，建议你对接口进行HTTP测试。<br>这里使用 httpexpect 对api进行测试，该库对响应的数据类型和结构验证有着较好的支持。</p>
<script src="https://gist.github.com/zacksleo/555ae102e87af209593c5303f441cbfc.js"></script>





          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zacksleo.github.io/2019/04/22/使用Gin搭建Oauth2服务并对进行授权和测试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zacksleo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zacks's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/22/使用Gin搭建Oauth2服务并对进行授权和测试/" itemprop="url">
                  使用Gin搭建Oauth2服务并对进行授权和测试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-22 23:29:00" itemprop="dateCreated datePublished" datetime="2019-04-22T23:29:00+08:00">2019-04-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 12:28:32" itemprop="dateModified" datetime="2019-10-22T12:28:32+08:00">2019-10-22</time>
              
            
          </span>

          

          
            
          

          
          
             <span id="/2019/04/22/使用Gin搭建Oauth2服务并对进行授权和测试/" class="leancloud_visitors" data-flag-title="使用Gin搭建Oauth2服务并对进行授权和测试">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>前面分别介绍了 <a href="https://zacksleo.github.io/2019/04/22/Golang%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E5%92%8C%E9%83%A8%E7%BD%B2/">Golang 持续集成与自动化测试和部署</a>和<a href="https://zacksleo.github.io/2019/04/24/%E4%BD%BF%E7%94%A8Gin%E5%BC%80%E5%8F%91Restful%E6%8E%A5%E5%8F%A3/">使用Gin开发Restful接口并进行自动化测试</a><br>那么Restful接口搭建好了以后，如何进行接口授权验证，本文将讲述这些内容。</p>
<h2 id="go-oauth2"><a href="#go-oauth2" class="headerlink" title="go-oauth2"></a>go-oauth2</h2><p>Oauth2 是一种验证授权机制，通过下发令牌，来实现接口的认证。</p>
<p><a href="https://github.com/go-oauth2/oauth2" target="_blank" rel="noopener">go-oauth2</a></p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">auth := r.Group(<span class="string">"/api/v1/oauth2"</span>)</span><br><span class="line">&#123;</span><br><span class="line">	auth.POST(<span class="string">"/tokens"</span>, controllers.CreateToken)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="控制器实现"><a href="#控制器实现" class="headerlink" title="控制器实现"></a>控制器实现</h2><script src="https://gist.github.com/zacksleo/0607c81ff5a427ed16683c479e2d97e3.js"></script>

<h2 id="获取Token的测试"><a href="#获取Token的测试" class="headerlink" title="获取Token的测试"></a>获取Token的测试</h2><p>这里为了方便在其他接口测试案例中调用获取token的方法，特意进行了拆分</p>
<script src="https://gist.github.com/zacksleo/4f52efceb3e2b3206de35f7e034f48fe.js"></script>
<script src="https://gist.github.com/zacksleo/916a4421de368a66036ab19731424d0b.js"></script>

<h2 id="其他接口的测试"><a href="#其他接口的测试" class="headerlink" title="其他接口的测试"></a>其他接口的测试</h2><script src="https://gist.github.com/zacksleo/bf09d04c5120f1a9c8f06cbeeb86cb6e.js"></script>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zacksleo.github.io/2019/04/22/Golang持续集成与自动化测试和部署/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zacksleo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zacks's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/22/Golang持续集成与自动化测试和部署/" itemprop="url">
                  Golang持续集成与自动化测试和部署
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-22 11:20:00" itemprop="dateCreated datePublished" datetime="2019-04-22T11:20:00+08:00">2019-04-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 12:28:32" itemprop="dateModified" datetime="2019-10-22T12:28:32+08:00">2019-10-22</time>
              
            
          </span>

          

          
            
          

          
          
             <span id="/2019/04/22/Golang持续集成与自动化测试和部署/" class="leancloud_visitors" data-flag-title="Golang持续集成与自动化测试和部署">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Golang是一门性能优异的静态类型语言，但因其奇快的编译速度，结合DevOps, 使得它也非常适合快速开发和迭代。</p>
<p>本文讲述如何使用Golang, 进行持续集成与自动化测试和部署。主要使用了以下相关技术：</p>
<ul>
<li><a href="https://github.com/golang/dep" target="_blank" rel="noopener">dep</a>： 进行包的依赖管理</li>
<li><a href="https://github.com/gin-gonic/gin" target="_blank" rel="noopener">gin</a>： 搭建 api 服务</li>
<li><a href="https://github.com/jinzhu/gorm" target="_blank" rel="noopener">gorm</a>：ORM, 数据CRUD</li>
<li><a href="http://github.com/go-sql-driver/mysql" target="_blank" rel="noopener">mysql</a>: 存储数据</li>
<li><a href="https://github.com/go-testfixtures/testfixtures" target="_blank" rel="noopener">testfixtures</a>： 测试夹具，在自动化测试时，自动向数据库填充用于测试的数据</li>
<li><a href="https://github.com/gavv/httpexpect" target="_blank" rel="noopener">httpexpect</a>: HTTP 测试包，用于API测试</li>
<li><a href="https://github.com/joho/godotenv" target="_blank" rel="noopener">GoDotEnv</a>: 环境变量处理</li>
<li>go test: 使用test命令进行单元测试, 基准测试和 HTTP 测试</li>
<li>GitLabCI: DevOps 工具</li>
<li><a href="https://github.com/golang/lint" target="_blank" rel="noopener">golint</a>: Golang 静态检查工具</li>
<li><a href="https://github.com/golang-migrate/migrate/" target="_blank" rel="noopener">migrate</a>: 数据库迁移工具</li>
<li>Docker: 使用 <a href="https://github.com/zacksleo/golang" target="_blank" rel="noopener">zacksleo/golang</a> 镜像, 该镜像默认安装了 curl,git,build-base,dep 和 golint</li>
<li><a href="https://github.com/Shelnutt2/db2struct" target="_blank" rel="noopener">db2struct</a>: 将数据库表结构一键生成为 struct(gorm的model)</li>
<li><a href="https://github.com/cweagans/apig/tree/dep-conversion" target="_blank" rel="noopener">apig</a>: 基于 gorm 和 gin 一键生成 CRUD API</li>
</ul>
<h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><ul>
<li>使用 apig 脚手架工具初始化项目结构和目录</li>
<li>使用 dep 安装相关依赖</li>
<li>使用 migrate 编写数据库迁移方法，并执行迁移创建数据表</li>
<li>使用 db2struct 生成 models</li>
<li>使用 apig 生成 crud 代码</li>
<li>使用 httpexpect 编写 api 测试代码，并通过 testfixtures 实现数据的自动填充</li>
<li>编写 GitLabCI 脚本进行持续集成</li>
</ul>
<p>在上述过程中，如需连接数据库时，可通过 GoDotEnv 来实现环境变量的使用</p>
<h2 id="相关CI脚本"><a href="#相关CI脚本" class="headerlink" title="相关CI脚本"></a>相关CI脚本</h2><script src="https://gist.github.com/zacksleo/6b86c61fff51939de7dbd6af531de9f3.js"></script>

<h2 id="集成测试"><a href="#集成测试" class="headerlink" title="集成测试"></a>集成测试</h2><script src="https://gist.github.com/zacksleo/a80e81fb4e7b8a8bd8289060c8190a60.js"></script>


<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>在测试中，如果需要区分单元测试和集成测试，可以使用 build tags 实现，如在文件头部中添加 <code>// +build integration</code>, 运行测试使用 <code>- go test -tags=integration $(go list ./tests/... | grep -v /vendor/) -v</code> 可以只执行集成测试</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="https://golang.org/pkg/testing/" target="_blank" rel="noopener">Go Test</a></li>
<li><a href="https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go" target="_blank" rel="noopener">How to write benchmarks in Go</a></li>
<li><a href="https://segmentfault.com/a/1190000016354758" target="_blank" rel="noopener">Go 性能调优之 —— 基准测试</a></li>
<li><a href="https://yar999.gitbooks.io/gopl-zh/content/" target="_blank" rel="noopener">Go语言圣经（中文版）</a></li>
<li><a href="https://stackoverflow.com/questions/25965584/separating-unit-tests-and-integration-tests-in-go" target="_blank" rel="noopener">使用tags区隔单元测试和集成测试</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zacksleo.github.io/2019/04/16/REST接口文档编写规范/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zacksleo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zacks's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/16/REST接口文档编写规范/" itemprop="url">
                  REST接口文档编写规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-16 15:41:26" itemprop="dateCreated datePublished" datetime="2019-04-16T15:41:26+08:00">2019-04-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 12:28:32" itemprop="dateModified" datetime="2019-10-22T12:28:32+08:00">2019-10-22</time>
              
            
          </span>

          

          
            
          

          
          
             <span id="/2019/04/16/REST接口文档编写规范/" class="leancloud_visitors" data-flag-title="REST接口文档编写规范">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>REST接口文档遵循 <a href="https://apiblueprint.org/" target="_blank" rel="noopener">API Blueprint 编码规范</a></p>
<p>中文说明需要遵循 <a href="https://github.com/mzlogin/chinese-copywriting-guidelines" target="_blank" rel="noopener">中文文案排版指北</a></p>
<p>按照该格式书写的文档, 可以被 GitLab 及 Gollum 完美解析</p>
<h2 id="主要内容"><a href="#主要内容" class="headerlink" title="主要内容"></a>主要内容</h2><ol>
<li>使用 Markdown 编写</li>
<li>请求和响应主体, 使用8个字符缩进</li>
<li>不使用` 包裹json代码</li>
</ol>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 用户密码 [/users/password]</span><br><span class="line"></span><br><span class="line">### 重置密码 [PATCH]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ Attributes</span><br><span class="line">    + phone (number, required) - 手机号码</span><br><span class="line">    + password (string, required) - 密码</span><br><span class="line">    + verify_code (string, required) - 短信验证码</span><br><span class="line"></span><br><span class="line">+ Header </span><br><span class="line">    + Authorization Bearer: &#123;clientToken&#125; - 访问令牌, 通过客户端模式获得</span><br><span class="line">    + Content-Type: application/json</span><br><span class="line"></span><br><span class="line">+ Request (application/json)</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            &quot;phone&quot;:&quot;17083300514&quot;,</span><br><span class="line">            &quot;password&quot;:&quot;pa66w0rd&quot;,</span><br><span class="line">            &quot;verify_code&quot;:&quot;312338&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">+ Response 201 (application/json)      </span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            &quot;phone&quot;:&quot;17083300514&quot;,</span><br><span class="line">            &quot;password&quot;:&quot;pa66w0rd&quot;,</span><br><span class="line">            &quot;verify_code&quot;:&quot;312338&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">+ Response 422 (application/json)</span><br><span class="line"></span><br><span class="line">        [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;field&quot;: &quot;verify_code&quot;,</span><br><span class="line">            &quot;message&quot;: &quot;短信验证码错误&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;field&quot;: &quot;phone&quot;,</span><br><span class="line">            &quot;message&quot;: &quot;手机号不存在&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">            &quot;field&quot;: &quot;password&quot;,</span><br><span class="line">            &quot;message&quot;: &quot;密码至少包含一位数字&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">## 扫描二维码 [/qrcode-tokens/&#123;ticket&#125;]</span><br><span class="line"></span><br><span class="line">### 更新状态 [PUT]</span><br><span class="line"></span><br><span class="line">+ Attributes</span><br><span class="line">    + action (string, required) - 动作, 值为SCANNED或LOGGED_IN</span><br><span class="line">    + ticket (string, required) - ticket 二维码中链接中后面的字符串</span><br><span class="line"></span><br><span class="line">+ Header </span><br><span class="line">    + Authorization: Bearer &#123;clientToken&#125;</span><br><span class="line">    + Content-Type: application/json</span><br><span class="line"></span><br><span class="line">+ Request (application/json)</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            &quot;action&quot;:&quot;SCANNED&quot;</span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">+ Response 201 (application/json)      </span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            &quot;action&quot;:&quot;SCANNED&quot;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://apiblueprint.org/" target="_blank" rel="noopener">API Blueprint官网</a></li>
<li><a href="https://github.com/apiaryio/api-blueprint" target="_blank" rel="noopener">GitHub</a></li>
<li><a href="https://blog.callmewhy.com/2014/06/05/blueprint-tutorial/" target="_blank" rel="noopener">API Blueprint 指导手册</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zacksleo.github.io/2019/04/16/DevOps软件开发流程规范/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zacksleo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zacks's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/16/DevOps软件开发流程规范/" itemprop="url">
                  DevOps 软件开发流程规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-16 15:34:00" itemprop="dateCreated datePublished" datetime="2019-04-16T15:34:00+08:00">2019-04-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 12:28:32" itemprop="dateModified" datetime="2019-10-22T12:28:32+08:00">2019-10-22</time>
              
            
          </span>

          

          
            
          

          
          
             <span id="/2019/04/16/DevOps软件开发流程规范/" class="leancloud_visitors" data-flag-title="DevOps 软件开发流程规范">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="流程概要"><a href="#流程概要" class="headerlink" title="流程概要"></a>流程概要</h2><p>持续集成和持续交付是 DevOps 最核心的两个部分。</p>
<p>持续集成通过即时将最新的代码，集成到主干分支，并进行相关的测试（单元测试、集成测试等）和静态检查（代码格式，代码质量等），以期提早发现问题。</p>
<p>持续交付，在持续集成完成之后，即时生成生产环境可用的产物（如二进制文件、包、或者 Docker镜像），并准备随时部署，如果伴随着部署过程，则称为持续部署。</p>
<h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><ul>
<li>系统分析与设计：需求分析，架构设计，数据库设计等</li>
<li>相关文档编写, 文档应与代码仓库一起</li>
<li><p>系统开发</p>
<ul>
<li>持续集成 (gitlab-ci)</li>
<li>格式检查和静态检查 (vscode, linter)</li>
<li>数据库迁移 (migration)</li>
<li>使用 Docker 搭建开发、测试和生产环境，docker-compose</li>
<li>Git开发流程 (git cz, master, branch )</li>
<li>自动化测试：单元测试，HTTP测试（api测试），功能测试，基准测试 (ab)</li>
<li>自动化部署（主备）(ngixn back)</li>
<li>更新日志 (angular changelog)</li>
<li>crontab supervisord</li>
</ul>
</li>
<li><p>测试与验收</p>
</li>
</ul>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="https://zacksleo.github.io/2017/03/07/RESTful%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83/">RESTful接口规范</a></li>
<li>接口文档编写规范</li>
<li><a href="https://zacksleo.github.io/2017/03/07/PHP%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/">PHP编码规范</a></li>
<li><a href="https://zacksleo.github.io/2017/03/07/Git%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E5%8F%8A%E4%BD%BF%E7%94%A8%E8%A7%84%E8%8C%83/">Git工作流程及使用规范</a></li>
<li><a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener">语义化版本 2.0.0</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zacksleo.github.io/2018/12/27/CentOS安装Docker并设置开机启动/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zacksleo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zacks's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/27/CentOS安装Docker并设置开机启动/" itemprop="url">
                  CentOS安装Docker并设置开机启动
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-27 16:31:06" itemprop="dateCreated datePublished" datetime="2018-12-27T16:31:06+08:00">2018-12-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 12:28:31" itemprop="dateModified" datetime="2019-10-22T12:28:31+08:00">2019-10-22</time>
              
            
          </span>

          

          
            
          

          
          
             <span id="/2018/12/27/CentOS安装Docker并设置开机启动/" class="leancloud_visitors" data-flag-title="CentOS安装Docker并设置开机启动">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li><p>删除旧版 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker docker-common  docker-selinux  docker-engine</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils  device-mapper-persistent-data  lvm2</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置stable repo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo  https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>
</li>
<li><p>开机启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>7 . hello world<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zacksleo.github.io/2018/12/16/GitLab-CI对ReactNative项目自动打包和部署(安卓篇)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zacksleo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zacks's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/16/GitLab-CI对ReactNative项目自动打包和部署(安卓篇)/" itemprop="url">
                  GitLab-CI对ReactNative项目自动打包和部署(安卓篇)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-16 11:21:26" itemprop="dateCreated datePublished" datetime="2018-12-16T11:21:26+08:00">2018-12-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 12:28:32" itemprop="dateModified" datetime="2019-10-22T12:28:32+08:00">2019-10-22</time>
              
            
          </span>

          

          
            
          

          
          
             <span id="/2018/12/16/GitLab-CI对ReactNative项目自动打包和部署(安卓篇)/" class="leancloud_visitors" data-flag-title="GitLab-CI对ReactNative项目自动打包和部署(安卓篇)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>本文讲述了如何使用 GitLab-CI 对 ReactNative 项目，自动打包和部署，由于安卓环境更易于在Docker上搭建环境，所以先实现了安卓应用的打包和部署。</p>
<h2 id="环境依赖"><a href="#环境依赖" class="headerlink" title="环境依赖"></a>环境依赖</h2><ol>
<li>Docker环境使用 registry.gitlab.com/wldhx/gitlab-ci-react-native-android:master 镜像, 该镜像包含了 ReactNative 打包安卓应用所需要的所有依赖</li>
<li>注册一个 <a href="https://fir.im/" target="_blank" rel="noopener">fir.im</a> 账号</li>
<li>Python3。 部署应用采用的 fir.im 平台发布，因此实现了一段用于自动上传 apk 的 Python 脚本</li>
<li>Node。 用于安卓依赖和格式化检查</li>
</ol>
<h2 id="编写GitLab-CI-脚本"><a href="#编写GitLab-CI-脚本" class="headerlink" title="编写GitLab-CI 脚本"></a>编写GitLab-CI 脚本</h2><p><code>$ cat .gitlab-ci.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image:</span> <span class="string">node</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">build</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line"><span class="attr">  key:</span> <span class="string">$&#123;CI_PROJECT_ID&#125;</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">android/.gradle/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line"><span class="attr">    NPM_CONFIG_CACHE:</span> <span class="string">"/cache/npm"</span></span><br><span class="line"><span class="attr">    YARN_CACHE_FOLDER:</span> <span class="string">"/cache/yarn"</span></span><br><span class="line"><span class="attr">    DOCKER_DRIVER:</span> <span class="string">overlay2</span></span><br><span class="line"><span class="attr">lint:</span></span><br><span class="line"><span class="attr">    stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">    dependencies:</span> <span class="string">[]</span></span><br><span class="line"><span class="attr">    cache:</span></span><br><span class="line"><span class="attr">      key:</span> <span class="string">"$CI_COMMIT_REF_NAME"</span></span><br><span class="line"><span class="attr">      policy:</span> <span class="string">pull</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">node_modules</span></span><br><span class="line"><span class="attr">    script:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">if</span> <span class="string">[</span> <span class="string">!</span> <span class="bullet">-d</span> <span class="string">"node_modules"</span> <span class="string">];</span> <span class="string">then</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">yarn</span> <span class="string">install</span> <span class="bullet">--cache-folder</span> <span class="string">/cache/yarn</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">fi</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">yarn</span> <span class="string">run</span> <span class="string">lint</span></span><br><span class="line"><span class="attr">    except:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">master</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">    tags:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">docker</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build-package:</span></span><br><span class="line"><span class="attr">    stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">    dependencies:</span> <span class="string">[]</span></span><br><span class="line"><span class="attr">    cache:</span></span><br><span class="line"><span class="attr">      key:</span> <span class="string">"$CI_COMMIT_REF_NAME"</span></span><br><span class="line"><span class="attr">      policy:</span> <span class="string">pull</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">node_modules</span></span><br><span class="line"><span class="attr">    script:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">yarn</span> <span class="string">install</span></span><br><span class="line"><span class="attr">    artifacts:</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">"node_modules"</span></span><br><span class="line"><span class="attr">        untracked:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">        expire_in:</span> <span class="number">60</span> <span class="string">mins</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">node_modules</span></span><br><span class="line"><span class="attr">    only:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">master</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">    tags:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">docker</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build-android:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">registry.gitlab.com/wldhx/gitlab-ci-react-native-android:master</span></span><br><span class="line"><span class="attr">    stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">    dependencies:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">build-package</span></span><br><span class="line"><span class="attr">    script:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">cd</span> <span class="string">android</span> <span class="string">&amp;&amp;</span> <span class="string">./gradlew</span> <span class="string">assembleRelease</span> <span class="bullet">--no-daemon</span></span><br><span class="line"><span class="attr">    artifacts:</span></span><br><span class="line"><span class="attr">        expire_in:</span> <span class="number">7</span> <span class="string">days</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">android/app/build/outputs/apk/</span></span><br><span class="line"><span class="attr">    only:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">master</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">tags</span></span><br><span class="line"></span><br><span class="line"><span class="attr">release-android:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">python:3</span></span><br><span class="line"><span class="attr">    stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">    cache:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"><span class="attr">    dependencies:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">build-android</span></span><br><span class="line"><span class="attr">    script:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">pip</span> <span class="string">install</span> <span class="bullet">-r</span> <span class="string">requirements.txt</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">if</span> <span class="string">[[</span> <span class="bullet">-z</span> <span class="string">"$CI_COMMIT_TAG"</span> <span class="string">]];then</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">echo</span> <span class="string">$(git</span> <span class="string">log</span> <span class="bullet">-3</span> <span class="bullet">--pretty=%s</span> <span class="string">| tail -1) &gt; ./release.txt</span></span><br><span class="line"><span class="string">        - else</span></span><br><span class="line"><span class="string">        - echo $(git tag -l --format='%(contents)' $CI_COMMIT_TAG) &gt; ./release.txt</span></span><br><span class="line"><span class="string">        - fi</span></span><br><span class="line"><span class="string">        - python ./upload.py</span></span><br><span class="line"><span class="string"></span><span class="attr">    only:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">master</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">tags</span></span><br></pre></td></tr></table></figure>
<p>该脚本分为三个阶段，第一阶段进行格式化检查，和安装 npm 依赖，第二阶段用于构建 apk, 第三阶段将apk上传到 fir.im 平台上，<br>其中 release.txt 用于存储最近的更新日志，便于在上传 apk 时，加上对应信息。</p>
<p>requirement.txt 文件中则使用了<code>request</code>库:</p>
<p><code>$ cat requirement.txt</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests</span><br></pre></td></tr></table></figure>
<p>upload.py 文件则调用fir.im的上传API, 则 apk 上传到改平台，需要注意的时，api_token 需要在 fir.im 平台的右上角个人信息处获取</p>
<p><code>$ cat upload.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file_get_contents</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = requests.post(</span><br><span class="line">    <span class="string">'https://api.fir.im/apps'</span>,</span><br><span class="line">    data=&#123;<span class="string">'type'</span>: <span class="string">'android'</span>,</span><br><span class="line">          <span class="string">'bundle_id'</span>: <span class="string">'com.company.package'</span>,</span><br><span class="line">          <span class="string">'api_token'</span>: <span class="string">'个人的API TOKEN'</span></span><br><span class="line">          &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">data = r.json()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.environ.get(<span class="string">'CI_COMMIT_TAG'</span>) <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">    tag = <span class="string">'latest'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    tag = os.environ[<span class="string">'CI_COMMIT_TAG'</span>]</span><br><span class="line"></span><br><span class="line">changelog = file_get_contents(<span class="string">'./release.txt'</span>)</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'file'</span>: open(</span><br><span class="line">    <span class="string">'./android/app/build/outputs/apk/release/app-release.apk'</span>, <span class="string">'rb'</span>)&#125;</span><br><span class="line">r2 = requests.post(</span><br><span class="line">    data[<span class="string">'cert'</span>][<span class="string">'binary'</span>][<span class="string">'upload_url'</span>],</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">'key'</span>: data[<span class="string">'cert'</span>][<span class="string">'binary'</span>][<span class="string">'key'</span>],</span><br><span class="line">        <span class="string">'token'</span>: data[<span class="string">'cert'</span>][<span class="string">'binary'</span>][<span class="string">'token'</span>],</span><br><span class="line">        <span class="string">'x:name'</span>: <span class="string">'应用名称'</span>,</span><br><span class="line">        <span class="string">'x:version'</span>: tag,</span><br><span class="line">        <span class="string">'x:build'</span>: <span class="string">'com.company.package'</span>,</span><br><span class="line">        <span class="string">'x:changelog'</span>: changelog</span><br><span class="line">    &#125;,</span><br><span class="line">    files=files</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">print(r2.json())</span><br></pre></td></tr></table></figure>
<h2 id="参考内容"><a href="#参考内容" class="headerlink" title="参考内容"></a>参考内容</h2><ul>
<li><a href="https://gitlab.com/gitlab-com/community-writers/issues/12" target="_blank" rel="noopener">How to build and publish your React Native Android applications using GitLab CI</a></li>
<li><a href="https://gitlab.com/wldhx/gitlab-ci-react-native-android" target="_blank" rel="noopener">gitlab-ci-react-native-android</a></li>
<li><a href="https://fir.im/docs" target="_blank" rel="noopener">fir.im 开发文档</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zacksleo.github.io/2018/08/16/手机号国际化支持解决方案/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zacksleo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zacks's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/16/手机号国际化支持解决方案/" itemprop="url">
                  手机号国际化支持解决方案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-16 22:08:26" itemprop="dateCreated datePublished" datetime="2018-08-16T22:08:26+08:00">2018-08-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 12:28:32" itemprop="dateModified" datetime="2019-10-22T12:28:32+08:00">2019-10-22</time>
              
            
          </span>

          

          
            
          

          
          
             <span id="/2018/08/16/手机号国际化支持解决方案/" class="leancloud_visitors" data-flag-title="手机号国际化支持解决方案">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ul>
<li>手机号参数对11位大陆手机号兼容  </li>
<li>支持国际手机号，请使用形如<code>(加号)(地区编码)(一个空格)(手机号)</code>的手机格式，例如</li>
</ul>
<table>
<thead>
<tr>
<th>地区</th>
<th>合法格式</th>
</tr>
</thead>
<tbody>
<tr>
<td>中国大陆</td>
<td>18682300424</td>
</tr>
<tr>
<td>中国大陆</td>
<td>+86 18682300424</td>
</tr>
<tr>
<td>美国</td>
<td>+1 2067925640</td>
</tr>
<tr>
<td>加拿大</td>
<td>+1 12042345678</td>
</tr>
<tr>
<td>英国</td>
<td>+44 7400123456</td>
</tr>
<tr>
<td>澳大利亚</td>
<td>+61 412345678</td>
</tr>
</tbody>
</table>
<p>所以手机格式为：以加号开头，前面是地区区号，后面是手机号码，中间保留一个空格</p>
<ul>
<li>如果国际手机号出现在URL中，请对手机号进行编码（urlencode）</li>
</ul>
<h2 id="存储和处理手机号码"><a href="#存储和处理手机号码" class="headerlink" title="存储和处理手机号码"></a>存储和处理手机号码</h2><ul>
<li>地区编号和手机号应当分开存储</li>
<li>增加对原11位手机号的兼容性（例如默认自动添加+86前缀）</li>
<li>存储用户信息时，需要将<code>phone</code>和<code>country_code</code>两个信息分别存储</li>
</ul>
<h2 id="验证和格式化手机号"><a href="#验证和格式化手机号" class="headerlink" title="验证和格式化手机号"></a>验证和格式化手机号</h2><ul>
<li>使用类库<code>https://github.com/googlei18n/libphonenumber</code> 或者其他语言的实现： <code>https://github.com/googlei18n/libphonenumber#third-party-ports</code></li>
</ul>
<h2 id="使用国际手机号测试"><a href="#使用国际手机号测试" class="headerlink" title="使用国际手机号测试"></a>使用国际手机号测试</h2><ul>
<li>搜索可以在线接收短信验证码的平台</li>
<li>在线接收短信验证码，进行后续测试</li>
<li>验证码接收网站参考网址:</li>
</ul>
<ul>
<li><code>http://receive-sms.com/</code></li>
<li><code>https://tieba.baidu.com/p/3752380669</code></li>
<li><code>http://uuxn.com/seven-recerve-sms-online-free-phone</code></li>
<li><code>http://www.mfwu.net/receive-sms.html</code></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zacksleo.github.io/2018/07/06/使用API网关Kong配置反向代理和负载均衡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zacksleo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zacks's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/06/使用API网关Kong配置反向代理和负载均衡/" itemprop="url">
                  使用API网关Kong配置反向代理和负载均衡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-06 15:02:00" itemprop="dateCreated datePublished" datetime="2018-07-06T15:02:00+08:00">2018-07-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 12:28:32" itemprop="dateModified" datetime="2019-10-22T12:28:32+08:00">2019-10-22</time>
              
            
          </span>

          

          
            
          

          
          
             <span id="/2018/07/06/使用API网关Kong配置反向代理和负载均衡/" class="leancloud_visitors" data-flag-title="使用API网关Kong配置反向代理和负载均衡">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a href="https://github.com/kong/kong" target="_blank" rel="noopener">Kong</a> 是一个微服务API网关。</p>
<blockquote>
<p>Kong是一个云原生，快速，可扩展和分布式微服务抽象层（也称为API网关，API中间件或在某些情况下为Service Mesh）。<br>作为2015年的开源项目，其核心价值在于高性能和可扩展性。<br>Kong积极维护，广泛应用于从创业公司到Global 5000以及政府组织等公司的生产。</p>
</blockquote>
<p><a href="https://github.com/pantsel/konga" target="_blank" rel="noopener">Konga</a> 是一个用于管理网关Kong的管理端，通过它可以方便的进网关进行管理配置。</p>
<p>使用网关能解决很多问题：</p>
<ol>
<li>解决端口和域名问题，代理后消除端口，将域名映射到端口，将服务映射成目录</li>
<li>微服务代理，将微服务置于内网，统一由网关代理</li>
<li>授权，可以配置授权管理，主要用于API授权</li>
<li>负载均衡，可以增强高访问量下的可用性，解决部署时的服务中断问题</li>
</ol>
<p>本文主要讲述使用 Konga 对 Kong 进行网关管理配置</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装过程具体请参考官网文档，如果使用docker安装 Kong 和 Konga，可以参考 配置<a href="https://github.com/warnstar/basic-auth-trans/blob/master/docker-compose.yml.dist" target="_blank" rel="noopener">docker-compose</a></p>
<h2 id="配置反向代理"><a href="#配置反向代理" class="headerlink" title="配置反向代理"></a>配置反向代理</h2><p>在 APIS 一栏，点击 <code>ADD NEW API</code> 按钮，添加一个代理：</p>
<ul>
<li>其中，Name 为显示名称，可任意填写；</li>
<li>Hosts 为所要使用的域名，如果不填写，则使用网关绑定的域名；如果填写，则可通过该域名访问；</li>
<li>Uris 为访问路径，如果需要将某个服务映射为一个目录，则此处需要配置; </li>
<li>Upstream URL 为上游地址，即微服务实际地址，另外可将微服务置于内网，此处即为内网地址。</li>
</ul>
<p>需要注意的是，如果页面中有301/302跳转，需要将 Preserve Host 勾选，以保证跳转后，header中携带的 Location 中的域名为代理后的域名，否则会出现实际域名/内网域名，造成混乱，甚至暴露微服务地址</p>
<h3 id="示例一：普通反向代理"><a href="#示例一：普通反向代理" class="headerlink" title="示例一：普通反向代理"></a>示例一：普通反向代理</h3><table>
<thead>
<tr>
<th>配置项</th>
<th>内容</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>dashboard</td>
<td>只是为了方便识别</td>
</tr>
<tr>
<td>Hosts</td>
<td>dashboard.xxx.com</td>
<td>绑定的域名，类似于vhosts</td>
</tr>
<tr>
<td>Uris</td>
<td>/</td>
<td>绑定目录</td>
</tr>
<tr>
<td>Methods</td>
<td></td>
<td>请求方法，默认不填</td>
</tr>
<tr>
<td>Upstream URL</td>
<td><a href="http://192.168.0.2:8080" target="_blank" rel="noopener">http://192.168.0.2:8080</a></td>
<td>实际微服务地址，建议使用内网ip, 并将该服务屏蔽外网访问</td>
</tr>
<tr>
<td>Strip uri</td>
<td>YES</td>
<td></td>
</tr>
<tr>
<td>Preserve Host</td>
<td>YES</td>
<td>转发时保留域名，处理301问题</td>
</tr>
<tr>
<td>Https only</td>
<td>YES</td>
<td>如果不使用https，不勾选</td>
</tr>
</tbody>
</table>
<h2 id="配置负载均衡"><a href="#配置负载均衡" class="headerlink" title="配置负载均衡"></a>配置负载均衡</h2><p>需要注意的是，如果要使用负载均衡，需要配置 上游 (UPSTREAMS)。</p>
<p>在 UPSTREAMS 一栏，点击添加，Name 为一个域名形式的上游名称，如 <code>dashboard.upstream.xxx.com</code>, 添加完后，点击详情里面的Targets，添加一个目标，<br>Target 为实际的微服务地址，如 <code>192.168.0.1:8080</code>, 注意这里不写http协议，只写ip或域名。</p>
<p>一个 UPSTREAMS 可以配置多个 Targets, 针对每个 Targets 设置不同的 Weight，即实现了负载均衡。</p>
<h3 id="示例二：负载均衡"><a href="#示例二：负载均衡" class="headerlink" title="示例二：负载均衡"></a>示例二：负载均衡</h3><p>UPSTREAMS 配置</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>内容</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>coupon.api.foundation.com</td>
<td>类域名的别名</td>
</tr>
</tbody>
</table>
<p>Targets 配置</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>内容</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Target</td>
<td>192.168.0.2:8001</td>
<td>微服务1的地址（建议使用内网）</td>
</tr>
<tr>
<td>WEIGHT</td>
<td>100</td>
<td>权重</td>
</tr>
</tbody>
</table>
<p>Targets2 配置</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>内容</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Target</td>
<td>192.168.0.3:8001</td>
<td>微服务1的地址</td>
</tr>
<tr>
<td>WEIGHT</td>
<td>100</td>
<td>权重</td>
</tr>
</tbody>
</table>
<p>…</p>
<p>Apis 配置</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>内容</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>coupon</td>
<td>名称，任意</td>
</tr>
<tr>
<td>Hosts</td>
<td></td>
<td>留空使用网关默认的域名，如 api.xxx.com</td>
</tr>
<tr>
<td>Uris</td>
<td>/coupon</td>
<td>通过 api.xxx.com/coupon 访问该服务</td>
</tr>
<tr>
<td>Methods</td>
<td></td>
<td>留空不限制</td>
</tr>
<tr>
<td>Upstream URL</td>
<td><a href="http://coupon.api.foundation.com/api/" target="_blank" rel="noopener">http://coupon.api.foundation.com/api/</a></td>
<td>这里为配置的 UPSTREAMS 里的 Name</td>
</tr>
<tr>
<td>Strip uri</td>
<td>YES</td>
<td></td>
</tr>
<tr>
<td>Preserve Host</td>
<td>YES</td>
<td></td>
</tr>
<tr>
<td>Https only</td>
<td>YES</td>
<td>如果不使用https，不勾选</td>
</tr>
</tbody>
</table>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="https://github.com/kong/kong" target="_blank" rel="noopener">Kong</a></li>
<li><a href="https://github.com/pantsel/konga" target="_blank" rel="noopener">Konga</a></li>
<li><a href="https://github.com/warnstar/basic-auth-trans" target="_blank" rel="noopener">basic-auth-trans</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zacksleo.github.io/2018/06/16/使用Taro和Typescript进行小程序开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zacksleo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zacks's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/16/使用Taro和Typescript进行小程序开发/" itemprop="url">
                  使用Taro和Typescript进行小程序开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-16 22:03:25" itemprop="dateCreated datePublished" datetime="2018-06-16T22:03:25+08:00">2018-06-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-22 12:28:32" itemprop="dateModified" datetime="2019-10-22T12:28:32+08:00">2019-10-22</time>
              
            
          </span>

          

          
            
          

          
          
             <span id="/2018/06/16/使用Taro和Typescript进行小程序开发/" class="leancloud_visitors" data-flag-title="使用Taro和Typescript进行小程序开发">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="使用Taro和Typescript进行小程序开发"><a href="#使用Taro和Typescript进行小程序开发" class="headerlink" title="使用Taro和Typescript进行小程序开发"></a>使用Taro和Typescript进行小程序开发</h2><h2 id="使用指南"><a href="#使用指南" class="headerlink" title="使用指南"></a>使用指南</h2><p>在使用 taro 生成 Typescript 模板以后，需要做以下修改：</p>
<h3 id="配置-eslintrc"><a href="#配置-eslintrc" class="headerlink" title="配置 .eslintrc"></a>配置 .eslintrc</h3><ul>
<li>加入 <code>&quot;no-undef&quot;: 0,</code> 以解决变量<code>undefined</code>的问题</li>
<li>加入 <code>&quot;react/jsx-filename-extension&quot;: [1, { &quot;extensions&quot;: [&quot;.js&quot;, &quot;.jsx&quot;] }]</code> 以解决 <code>JSX not allowed in files with extension &#39;.tsx</code></li>
</ul>
<h3 id="增加配置文件"><a href="#增加配置文件" class="headerlink" title="增加配置文件"></a>增加配置文件</h3><ul>
<li>tsconfig.json</li>
<li>tslint 文件</li>
</ul>
<h3 id="增加依赖库"><a href="#增加依赖库" class="headerlink" title="增加依赖库"></a>增加依赖库</h3><ul>
<li>yarn add –dev tslint</li>
<li>yarn add –dev tslint-react</li>
<li>yarn add –dev ptypescript-eslint-parser</li>
</ul>
<h2 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">yarn install</span><br></pre></td></tr></table></figure>
<h2 id="代码静态检查"><a href="#代码静态检查" class="headerlink" title="代码静态检查"></a>代码静态检查</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn run lint</span><br></pre></td></tr></table></figure>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="https://taro.aotu.io/" target="_blank" rel="noopener">Taro官方文档</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">zacksleo</p>
              <p class="site-description motion-element" itemprop="description">Full Stack Web Developer</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">52</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">80</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/zacksleo" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zacksleo</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.2.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  



	





  





  






<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    





  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("6ewRRbjRaYybcLL2fRlMKDtT-gzGzoHsz", "NhhOjGzUPay4gOs6hP0RzgdH");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text(counter.get('time'));
            
            counter.save(null, {
              success: function(counter) {
                
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            
              var newcounter = new Counter();
              /* Set ACL */
              var acl = new AV.ACL();
              acl.setPublicReadAccess(true);
              acl.setPublicWriteAccess(true);
              newcounter.setACL(acl);
              /* End Set ACL */
              newcounter.set("title", title);
              newcounter.set("url", url);
              newcounter.set("time", 1);
              newcounter.save(null, {
                success: function(newcounter) {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                },
                error: function(newcounter, error) {
                  console.log('Failed to create');
                }
              });
            
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  
  

  

  

  

  

  

</body>
</html>
